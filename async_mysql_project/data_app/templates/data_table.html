{% extends 'index.html' %}

{% block content %}
    <div class="container-fluid-neverov">
        <h3>Закупки</h3>
    </div>
    <div class="container-fluid-neverov">
        <form method="GET" action="/" id="filter-form" class="form-group">
            <div class="form-item">
                <input type="text" class="form-control" id="keyword_one" name="keyword_one" placeholder="Ключевое слово 1"
                    value="{% if request.GET.keyword_one == 'None' %}{% else %}{{ request.GET.keyword_one }}{% endif %}">
            <br>

                <select name="selected_column_one" id="selected_column_one" class="form-control">
                    <option data-type="no_format" value="">Столбец 1</option>
                    {% for value, label in options %}
                        <option data-type="no_format" value="{{ value }}" {% if selected_column_one == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <input type="text" class="form-control" id="keyword_two" name="keyword_two" placeholder="Ключевое слово 2"
                    value="{% if request.GET.keyword_two == 'None' %}{% else %}{{ request.GET.keyword_two }}{% endif %}">
            <br>

                <select name="selected_column_two" id="selected_column_two" class="form-control">
                    <option data-type="no_format" value="">Столбец 2</option>
                    {% for value, label in options %}
                        <option data-type="no_format" value="{{ value }}" {% if selected_column_two == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <input type="text" class="form-control" id="keyword_three" name="keyword_three" placeholder="Ключевое слово 3"
                    value="{% if request.GET.keyword_three == 'None' %}{% else %}{{ request.GET.keyword_three }}{% endif %}">
            <br>

                <select name="selected_column_three" id="selected_column_three" class="form-control">
                    <option data-type="no_format" value="">Столбец 3</option>
                    {% for value, label in options %}
                        <option data-type="no_format" value="{{ value }}" {% if selected_column_three == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <input type="text" class="form-control" id="keyword_four" name="keyword_four" placeholder="Ключевое слово 4"
                    value="{% if request.GET.keyword_four == 'None' %}{% else %}{{ request.GET.keyword_four }}{% endif %}">
            <br>

                <select name="selected_column_four" id="selected_column_four" class="form-control">
                    <option data-type="no_format" value="">Столбец 4</option>
                    {% for value, label in options %}
                        <option data-type="no_format" value="{{ value }}" {% if selected_column_four == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <select name="contract_date" id="contract_date" class="form-control form-control-year">
                    <option data-type="no_format" value="No">Дата контракта</option>
                    {% for contract_date in service_years %}
                    <option data-type="no_format" value="{{ contract_date }}" {% if contract_date == selected_contract_date %}selected{% endif %}>
                        {{ contract_date }}
                    </option>
                    {% endfor %}
                </select>
            <br>
                <select name="end_date" id="end_date" class="form-control form-control-year">
                    <option data-type="no_format" value="No">Окончание даты</option>
                    {% for end_date in service_end_date %}
                    <option data-type="no_format" value="{{ end_date }}" {% if end_date == selected_end_date %}selected{% endif %}>
                        {{ end_date }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <button type="submit" class="btn btn-primary">Фильтровать</button>
                <br>
                <button type="button" class="btn btn-secondary" id="reset-filters">Сбросить всё</button>
            </div>
        </form>
    </div>

    <div class="container-fluid-neverov">
        <a href="{% url 'add' %}?page={{ page }}{{ params }}&total_pages={{ total_pages }}" class="btn btn-warning edit-link">Добавить закупку</a>
    </div>

    <div class="container-fluid-neverov">

        <div class="scroll-container top-scroll">
            <div class="scroll-content"></div>
        </div>

        <div class="scroll-container main-scroll">
            <table id="myTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" class="fixed-width">Управление</th>
                        <th rowspan="2" class="fixed-width">Смена цвета</th>
                        <th rowspan="2" class="fixed-width">№ п/п</th>
                        <th rowspan="2" class="stretch-width-min">Наименование закупки</th>
                        <th rowspan="2" class="stretch-width">Статус</th>
                        <th rowspan="2" class="fixed-width">Способ закупки</th>
                        <th rowspan="2" class="stretch-width">Инициатор закупки (ИТ/АХО)</th>
                        <th rowspan="2" class="fixed-width">КЦСР</th>
                        <th rowspan="2" class="stretch-width">КОСГУ</th>
                        <th rowspan="2" class="fixed-width-medium">ДопФК</th>
                        <th rowspan="2" class="fixed-width-date">НМЦК</th>
                        <th rowspan="2" class="stretch-width">Экономия</th>
                        <th rowspan="2" class="stretch-width-min">Контрагент</th>
                        <th rowspan="2" class="fixed-width-date">Реестровый номер контракта (ЕИС)</th>
                        <th rowspan="2" class="fixed-width-date">Номер контракта</th>
                        <th rowspan="2" class="fixed-width-date">Дата контракта</th>
                        <th rowspan="2" class="fixed-width-small">Окончание даты исполнения</th>
                        <th rowspan="2" class="fixed-width-small">Цена контракта</th>
                        <th rowspan="2" class="fixed-width-small">Исполнение контракта (план) (формула)</th>
                        <th rowspan="2" class="fixed-width-small">Сумма текущего года (формула)</th>
                        <th rowspan="2" class="stretch-width">Январь (план)</th>
                        <th rowspan="2" class="fixed-width">Февраль (план)</th>
                        <th rowspan="2" class="fixed-width">Март (план)</th>
                        <th rowspan="2" class="fixed-width">Апрель (план)</th>
                        <th rowspan="2" class="fixed-width">Май (план)</th>
                        <th rowspan="2" class="fixed-width">Июнь (план)</th>
                        <th rowspan="2" class="fixed-width">Июль (план)</th>
                        <th rowspan="2" class="fixed-width">Август (план)</th>
                        <th rowspan="2" class="fixed-width">Сентябрь (план)</th>
                        <th rowspan="2" class="fixed-width">Октябрь (план)</th>
                        <th rowspan="2" class="fixed-width">Ноябрь (план)</th>
                        <th rowspan="2" class="fixed-width">Декабрь (план)</th>
                        <th rowspan="2" class="fixed-width">Остаток контракта на следующий год</th>
                        <th rowspan="2" class="fixed-width">Исполнение контракта (факт) (формула)</th>
                        <th rowspan="2" class="fixed-width">Оплачено в предыдущем году</th>
                        <th colspan="2" class="fixed-width">Январь (факт)</th>
                        <th colspan="2" class="fixed-width">Февраль (факт)</th>
                        <th colspan="2" class="fixed-width">Март (факт)</th>
                        <th colspan="2" class="fixed-width">Апрель (факт)</th>
                        <th colspan="2" class="fixed-width">Май (факт)</th>
                        <th colspan="2" class="fixed-width">Июнь (факт)</th>
                        <th colspan="2" class="fixed-width">Июль (факт)</th>
                        <th colspan="2" class="fixed-width">Август (факт)</th>
                        <th colspan="2" class="fixed-width">Сентябрь (факт)</th>
                        <th colspan="2" class="fixed-width">Октябрь (факт)</th>
                        <th colspan="2" class="fixed-width">Ноябрь (факт)</th>
                        <th colspan="2" class="fixed-width">Декабрь (факт)</th>
                        <th colspan="2" class="fixed-width">Январь (факт)</th>
                        <th rowspan="2" class="fixed-width">% исполнения (формула)</th>
                        <th rowspan="2" class="fixed-width">Остаток по контракту (формула)</th>
                    </tr>
                    <tr>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                        <th class="fixed-width">Дата оплаты</th>
                        <th class="fixed-width">Сумма оплаты</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data %}
                    <tr class="service-row" data-id="{% if user.is_authenticated %}{{ item.id }}{% else %}0{% endif %}">
                        <td class="stretch-width">
                            <!-- Управление -->
                            <div style="display: flex; justify-content: center; align-items: center; gap: 5px;">
                                <a href="{% url 'edit' row_id=item.id %}?page={{ page }}{{ params }}"
                                class="btn btn-sm btn-warning edit-link">Edit</a>
                                <a href="{% url 'copy' row_id=item.id %}?page={{ page }}{{ params }}&total_pages={{ total_pages }}"
                                class="btn btn-sm btn-warning edit-link">Copy</a>
                                <form class="delete-form"
                                    data-id="{{ item.id }}"
                                    data-page="{{ page }}"
                                    data-keyword-one="{{ keyword_one }}"
                                    data-keyword-two="{{ keyword_two }}"
                                    data-keyword-three="{{ keyword_three }}"
                                    data-keyword-four="{{ keyword_four }}"
                                    data-selected-column-one="{{ selected_column_one }}"
                                    data-selected-column-two="{{ selected_column_two }}"
                                    data-contract-date="{{ selected_contract_date }}"
                                    data-selected-end-date="{{ selected_end_date }}"

                                    data-page-user="{{ page_user }}"

                                    data-page-user-two="{{ page_user_two }}"

                                style="display:inline;">

                                    <button type="button" class="btn btn-sm btn-danger delete-button">Delete</button>
                                </form>
                            </div>
                        </td>
                        <td class="stretch-width">
                            <!-- Выбор цвета -->
                            <!-- <p>User ID: {{ user.id }}</p> -->
                            <!-- <p>Authenticated: {{ user.is_authenticated }}</p> -->
                            <select class="form-control color-select" data-id="{% if user.is_authenticated %}{{ item.id }}{% else %}0{% endif %}">
                                <option value="#ffffff">Default</option>
                                <option value="#eaf7ff" {% if item.color == '#eaf7ff' %}selected{% endif %}>Light Blue</option>
                                <option value="#ffebeb" {% if item.color == '#ffebeb' %}selected{% endif %}>Light Red</option>
                                <option value="#dff0d8" {% if item.color == '#dff0d8' %}selected{% endif %}>Light Green</option>
                                <option value="#f5f5f5" {% if item.color == '#f5f5f5' %}selected{% endif %}>Light Grey</option>
                                <option value="#fff8e1" {% if item.color == '#fff8e1' %}selected{% endif %}>Light Yellow</option>
                            </select>
                        </td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.id_id }}</td>
                        <td class="stretch-width-min" style="background-color: {{ item.color|default:'' }}"><div data-type="no_format" class="text-content">{{ item.name }}</div><button class="toggle-button">Показать больше</button></td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.status }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.way }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.initiator }}</td>
                        <td data-type="no_format" class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.KTSSR }}</td>
                        <td data-type="no_format" class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.KOSGU }}</td>
                        <td data-type="no_format" class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.DopFC }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.NMCC }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.saving }}</td>
                        <td data-type="no_format" class="stretch-width-min" style="background-color: {{ item.color|default:'' }}">{{ item.counterparty }}</td>
                        <td data-type="no_format" class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.registration_number }}</td>
                        <td data-type="no_format" class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.contract_number }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.contract_date }}</td>
                        <td data-type="no_format" class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.end_date }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.contract_price }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.execution_contract_plan }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.remainder_old_year }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.january_one }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.february }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.march }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.april }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.may }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.june }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.july }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.august }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.september }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.october }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.november }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.december }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.january_two }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.execution_contract_fact }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.paid_last_year }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_january_one }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_january_one }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_february }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_february }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_march }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_march }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_april }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_april }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_may }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_may }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_june }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_june }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_july }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_july }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_august }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_august }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_september }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_september }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_october }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_october }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_november }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_november }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_december }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_december }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.date_january_two }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.sum_january_two }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.execution }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.contract_balance }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Создаем строку с подстановкой значений
        const raw_query_string = `{{ params|safe }}`;
        // Удаляем первый символ (например, &)
        const query_string = raw_query_string.startsWith('&') ? raw_query_string.slice(1) : raw_query_string;

        // Функция для обновления всех ссылок с нужной query строкой
        function updateLinks() {
            // Получаем все ссылки, которые нужно обновить
            const links = document.querySelectorAll('.pagination .page-link');

            // Обновляем href каждой ссылки
            links.forEach(link => {
                let url = link.getAttribute('href');
                if (url) {
                    // Добавляем query_string к каждому href
                    if (url.includes('?')) {
                        link.setAttribute('href', url + '&' + query_string);
                    } else {
                        link.setAttribute('href', url + '?' + query_string);
                    }
                }
            });
        }

        // Вызываем функцию обновления ссылок
        document.addEventListener('DOMContentLoaded', updateLinks);
    </script>

    <div class="container-fluid-neverov">
        <div style="display: flex; justify-content: flex-end;">
            <!-- Pagination Controls -->
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    {% if page > 1 %}
                    <li class="page-item">
                        <a data-type="no_format" class="page-link" href="{% url 'data_table_view' %}?page={{ page|add:"-1" }}"
                            aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Show "Previous" button if not on the first page group -->
                    {% if start_page > 1 %}
                    <li class="page-item">
                        <a data-type="no_format" class="page-link"
                            href="{% url 'data_table_view' %}?page=1">1</a>
                    </li>
                        {% if start_page > 2 %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                    {% endif %}

                    <!-- Show a few pages around the current page -->
                    {% for p in pages %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a data-type="no_format" class="page-link" href="{% url 'data_table_view' %}?page={{ p }}">{{ p }}</a>
                    </li>
                    {% endfor %}

                    <!-- Show "Next" button if not on the last page group -->
                    {% if end_page < total_pages %}
                    <li class="page-item">
                        <a data-type="no_format" class="page-link" href="{% url 'data_table_view' %}?page={{ total_pages }}">{{ total_pages }}</a>
                    </li>
                    {% endif %}

                    {% if page < total_pages %}
                    <li class="page-item">
                        <a data-type="no_format" class="page-link" href="{% url 'data_table_view' %}?page={{ page|add:"1" }}"
                            aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>

    <div class="container-fluid-neverov">
        <h2>Итоги по фильтру:</h2>

        <h4>Итог НМЦК: {{ total_cost_111 }}</h4>
        <h4>Итог Цена контракта: {{ total_cost_222 }}</h4>
        <h4>Итог Исполнение контракта (факт): {{ total_cost_333 }}</h4>

        <h2>Импорт/экспорт Excel:</h2>

        <form onsubmit="showFlashMessage(event)">
            <div class="alert" id="flash-message-export" style="display: none;"></div>
            <input type="file" id="file-input" accept=".xlsx" style="display: none;" onchange="updateFileName()">
            <button type="button" class="btn btn-info" onclick="document.getElementById('file-input').click();">Импорт Excel</button>
            <div>
                <span id="file-name"></span>
            </div>

            <div>
                <button type="submit" class="btn btn-success" style="display: none;" id="submit-button">Отправить</button>
            </div>
        </form>

        <form id="export-form">
            <input type="hidden" name="contract_date" value="{% if selected_contract_date %}{{ selected_contract_date }}{% else %}No{% endif %}">
            <input type="hidden" name="end_date" value="{% if selected_end_date %}{{ selected_end_date }}{% else %}No{% endif %}">
            <div class="alert alert-success" id="flash-message-import" style="display: none;"></div>
            <button type="submit" class="btn btn-primary" id="export-button">Экспорт Excel</button>
        </form>

        {% comment %} <div style="display: flex; gap: 5px; justify-content: center; align-items: center;">
            <form onsubmit="showFlashMessage(event)">
                <div class="alert" id="flash-message-export" style="display: none;"></div>
                <input type="file" id="file-input" accept=".xlsx" style="display: none;" onchange="updateFileName()">
                <button type="button" class="btn btn-info" onclick="document.getElementById('file-input').click();">Импорт Excel</button>
                <div>
                    <span id="file-name"></span>
                </div>

                <div>
                    <button type="submit" class="btn btn-success" style="display: none;" id="submit-button">Отправить</button>
                </div>
            </form>

            <form id="export-form">
                <input type="hidden" name="contract_date" value="{% if selected_contract_date %}{{ selected_contract_date }}{% else %}No{% endif %}">
                <input type="hidden" name="end_date" value="{% if selected_end_date %}{{ selected_end_date }}{% else %}No{% endif %}">
                <div class="alert alert-success" id="flash-message-import" style="display: none;"></div>
                <button type="submit" class="btn btn-primary" id="export-button">Экспорт Excel</button>
            </form>
        </div> {% endcomment %}

        <h2>Заменить данные из резерва:</h2>

        <form>
            <div class="alert alert-success" id="flash-message-one" style="display: none;"></div>
            <button type="submit" class="btn btn-secondary" id="backup-one-button" data-url="{% url 'backup_to_backup_one' %}">Резерв (Вторник)</button>
            <div class="alert alert-success" id="flash-message-two" style="display: none;"></div>
            <button type="submit" class="btn btn-success" id="backup-two-button" data-url="{% url 'backup_to_backup_two' %}">Резерв (Четверг)</button>
        </form>

    </div>
{% endblock %}

{% block content_user %}
    <div class="container-fluid-neverov">
        <h3>Свод</h3>
    </div>

    <div class="container-fluid-neverov">
        <a href="{% url 'add_two' %}?page={{ page }}{{ params }}" class="btn btn-warning edit-link">Добавить свод</a>
    </div>

    <div class="container-fluid-neverov">

        <div class="scroll-container top-scroll">
            <div class="scroll-content"></div>
        </div>

        <div class="scroll-container main-scroll">
            <table id="myTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" class="fixed-width">Управление</th>

                        <th rowspan="2" class="stretch-width">Наименование</th>
                        <th rowspan="2" class="stretch-width">КОСГУ</th>
                        <th rowspan="2" class="fixed-width">ДопФК</th>
                        <th colspan="2" class="stretch-width">Лимиты</th>
                        <th colspan="2" class="fixed-width">Запланировано</th>
                        <th colspan="2" class="fixed-width">В торгах</th>
                        <th colspan="2" class="fixed-width">Заключено</th>
                        <th colspan="2" class="fixed-width-medium">Исполнено</th>
                        <th colspan="2" class="fixed-width-medium">Кассовое исполнение</th>
                        <th colspan="2" class="fixed-width-date">Остаток</th>
                        <th colspan="2" class="stretch-width">Остаток с учетом планов</th>

                    </tr>
                    <tr>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data_user %}
                    <tr class="service-row-user" data-id="{% if user.is_authenticated %}{{ item.id }}{% else %}0{% endif %}">

                        <td class="stretch-width">
                            <!-- Управление -->
                            <div style="display: flex; justify-content: center; align-items: center; gap: 5px;">
                                <a href="{% url 'edit_user' row_id=item.id %}?page={{ page }}{{ params }}"
                                class="btn btn-sm btn-warning edit-link">Edit</a>
                                <form class="delete-form-user"
                                    data-id="{{ item.id }}"
                                    data-page="{{ page }}"
                                    data-keyword_one="{{ keyword_one }}"
                                    data-keyword_two="{{ keyword_two }}"
                                    data-keyword_three="{{ keyword_three }}"
                                    data-keyword_four="{{ keyword_four }}"
                                    data-selected_column_one="{{ selected_column_one }}"
                                    data-selected_column_two="{{ selected_column_two }}"
                                    data-contract_date="{{ selected_contract_date }}"
                                    data-selected_end_date="{{ selected_end_date }}"

                                    data-page-user="{{ page_user }}"

                                    data-page-user-two="{{ page_user_two }}"

                                style="display:inline;">
                                    <button type="button" class="btn btn-sm btn-danger delete-button-user">Delete</button>
                                </form>
                            </div>
                        </td>

                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.name }}</td>
                        <td data-type="no_format" class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.KOSGU }}</td>
                        <td data-type="no_format" class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.DopFC }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.budget_limit }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_limit }}</td>
                        <td class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.budget_planned }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_planned }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.budget_bargaining }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_bargaining }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.budget_concluded }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_concluded }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.budget_completed }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_completed }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.budget_execution }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_execution }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.budget_remainder }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_remainder }}</td>
                        <td class="stretch-width" style="background-color: {{ item.color|default:'' }}">{{ item.budget_plans }}</td>
                        <td class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_plans }}</td>

                    </tr>
                    {% endfor %}
                    <tr class="service-row-user">
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Итого:</td>
                        <td class="fixed-width">{{ total_cost_1 }}</td>
                        <td class="fixed-width">{{ total_cost_2 }}</td>
                        <td class="fixed-width">{{ total_cost_3 }}</td>
                        <td class="fixed-width">{{ total_cost_4 }}</td>
                        <td class="fixed-width">{{ total_cost_5 }}</td>
                        <td class="fixed-width">{{ total_cost_6 }}</td>
                        <td class="fixed-width">{{ total_cost_7 }}</td>
                        <td class="fixed-width">{{ total_cost_8 }}</td>
                        <td class="fixed-width">{{ total_cost_9 }}</td>
                        <td class="fixed-width">{{ total_cost_10 }}</td>
                        <td class="fixed-width">{{ total_cost_11 }}</td>
                        <td class="fixed-width">{{ total_cost_12 }}</td>
                        <td class="fixed-width">{{ total_cost_13 }}</td>
                        <td class="fixed-width">{{ total_cost_14 }}</td>
                        <td class="fixed-width">{{ total_cost_15 }}</td>
                        <td class="fixed-width">{{ total_cost_16 }}</td>
                    </tr>
                    <tr>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Итого СГОЗ:</td>
                        <td class="fixed-width">{{ total_cost_17 }}</td>
                    </tr>
                    <tr>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Итого Кассовое исполнение:</td>
                        <td class="fixed-width">{{ total_cost_18 }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="container-fluid-neverov">

    </div>
{% endblock %}

{% block content_user_two %}
    <div class="container-fluid-neverov">
        <h3>План-график</h3>
    </div>

    <div class="container-fluid-neverov">

        <div class="scroll-container top-scroll">
            <div class="scroll-content"></div>
        </div>

        <div class="scroll-container main-scroll">
            <table id="myTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" class="fixed-width">Управление</th>
                        <th rowspan="2" class="stretch-width">КОСГУ</th>
                        <th rowspan="2" class="stretch-width">ДопФК</th>
                        <th colspan="2" class="fixed-width">Внесено в план - график (прошлый год)</th>
                        <th colspan="2" class="fixed-width">Внесено в план - график (настоящий год)</th>
                        <th colspan="2" class="fixed-width">Заключено</th>
                        <th colspan="2" class="fixed-width-date">Остаток</th>
                    </tr>
                    <tr>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                        <th class="fixed-width">Бюджет</th>
                        <th class="fixed-width">Внебюджет</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data_user_two %}
                    <tr class="service-row-user-two" data-id="{% if user.is_authenticated %}{{ item.id }}{% else %}0{% endif %}">
                        <td class="stretch-width">
                            <!-- Управление -->
                            <div style="display: flex; justify-content: center; align-items: center; gap: 5px;">
                                <a href="{% url 'edit_user_two' row_id=item.id %}?page={{ page }}{{ params }}"
                                class="btn btn-sm btn-warning edit-link">Edit</a>

                            </div>
                        </td>
                        <td data-type="no_format" class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.KOSGU }}</td>
                        <td data-type="no_format" class="fixed-width" style="background-color: {{ item.color|default:'' }}">{{ item.DopFC }}</td>
                        <td class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.budget_planned_old }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_planned_old }}</td>
                        <td class="fixed-width-medium" style="background-color: {{ item.color|default:'' }}">{{ item.budget_planned }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_planned }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.budget_concluded }}</td>
                        <td class="fixed-width-date" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_concluded }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.budget_remainder }}</td>
                        <td class="fixed-width-small" style="background-color: {{ item.color|default:'' }}">{{ item.off_budget_remainder }}</td>

                    </tr>
                    {% endfor %}

                    <tr class="service-row-user">
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Итого:</td>
                        <td class="fixed-width">{{ total_cost_1_11 }}</td>
                        <td class="fixed-width">{{ total_cost_1_22 }}</td>
                        <td class="fixed-width">{{ total_cost_1_1 }}</td>
                        <td class="fixed-width">{{ total_cost_1_2 }}</td>
                        <td class="fixed-width">{{ total_cost_1_3 }}</td>
                        <td class="fixed-width">{{ total_cost_1_4 }}</td>
                        <td class="fixed-width">{{ total_cost_1_5 }}</td>
                        <td class="fixed-width">{{ total_cost_1_6 }}</td>
                    </tr>
                    <tr>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Итого СГОЗ:</td>
                        <td class="fixed-width">{{ total_cost_17 }}</td>
                    </tr>
                    <tr>
                        <td class="fixed-width"></td>
                        <td class="fixed-width"></td>
                        <td class="fixed-width">Остаток:</td>
                        <td class="fixed-width">{{ total_cost_1_7 }}</td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>

    <div class="container-fluid-neverov">

    </div>
{% endblock %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Государственные закупки</title>
    {% comment %} {% load static %} {% endcomment %}
    {% load cache_busting %}
    <link rel="stylesheet" href="{% bust_static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% bust_static 'style.css' %}">
    <link rel="icon" href="{% bust_static 'favicon.ico' %}" type="image/x-icon">
</head>

<style>
    .header-flex {
        display: flex;
        align-items: stretch; /* чтобы выровнять по вертикали */
        flex-wrap: wrap;
        width: 100%;
      }
      
      /* Левый блок — только размер картинки */
      .header-flex > .container-fluid-neverov:first-child {
        flex: 0 0 auto; /* как у вас */
        margin-right: 20px;
        display: flex;             /* превращаем в flex */
        justify-content: center;   /* центрируем по горизонтали */
        align-items: center;       /* центрируем по вертикали */
      }
      
      /* Правый блок — остальное пространство */
      .header-flex > .container-fluid-neverov:last-child {
        flex: 1 1 0;
        min-width: 0; /* чтобы текст не выталкивал */
      }
      
      @media (max-width: 768px) {
        .header-flex {
          flex-direction: column;
          align-items: stretch;
        }
        .header-flex > .container-fluid-neverov:first-child {
          margin-right: 0;
          margin-bottom: 10px;
        }
        .header-flex > .container-fluid-neverov:last-child {
          flex: 1 1 100%;
        }
      }      
</style>

<body>

    <div class="center-content">
        <!-- ОБЁРТКА ТОЛЬКО ДЛЯ ПЕРВЫХ ДВУХ БЛОКОВ -->
        <div class="header-flex">
        
            <div class="container-fluid-neverov">
                <img src="{% bust_static 'logo.svg' %}" alt="Логотип" style="height: 150px;">
            </div>

            <div class="container-fluid-neverov">
                <h1>Государственные закупки</h1>

                {% comment %} {% if messages %}
                    {% for message in messages %}
                        <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} mt-3">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %} {% endcomment %}

                <div class="center-content">
                    <ul class="navbar-nav ml-auto">
                        {% if user.is_authenticated %}
                            <h4 data-type="no_format" style="color: #007bff;">Пользователь: {{ user.username }}</h4>
                            <a class="btn btn-sm btn-danger delete-button d-button" href="{% url 'admin:index' %}">Админ панель</a>
                            <!-- Замена ссылки на выход на форму -->
                            <form method="POST" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success">Выход</button>
                            </form>
                        {% else %}
                            <a class="nav-link" href="{% url 'account_login' %}">Login</a>
                            <a class="nav-link" href="{% url 'account_signup' %}">Sign Up</a>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
        <!-- ВСЁ, ЧТО ИДЁТ НИЖЕ, БУДЕТ УЖЕ ПОД ЭТИМ ФЛЕКС-КОНТЕЙНЕРОМ -->
            {% block content %}{% endblock %}
            {% block content_user %}{% endblock %}
            {% block content_user_two %}{% endblock %}
            {% comment %} {% if user.id != 20 and user.id != 21 %}
                {% block content_user_two %}{% endblock %}
            {% endif %} {% endcomment %}
    </div>

    <script>
        const connection_websocket = "{{ connection_websocket }}"; // Теперь это будет строка
        console.log("Connection WebSocket:", connection_websocket);
    </script>
    <script src="{% bust_static 'js/jquery-3.5.1.slim.min.js' %}"></script>
    <script src="{% bust_static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% bust_static 'script.js' %}"></script>  <!-- Добавьте ваш JS файл -->

    <div id="deletion-overlay" style="
        display: none; 
        position: fixed; 
        top: 0; 
        left: 0;
        width: 100%; 
        height: 100%; 
        background: rgba(0,0,0,0.5); 
        z-index: 10000;
        align-items: center; 
        justify-content: center; 
        color: white; 
        font-size: 24px;
        text-align: center;
    ">
        В процессе...
    </div>

    {% comment %} <div id="message-overlay" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
    "></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const messages = [
                {% if messages %}
                    {% for message in messages %}
                        {
                            text: "{{ message|escapejs }}",
                            tags: "{{ message.tags }}"
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                {% else %}
                    // Нет сообщений
                {% endif %}
            ];

            if (messages.length > 0) {
                const overlay = document.getElementById('message-overlay');

                let fullText = "";
                messages.forEach(msg => {
                    fullText += msg.text + "\n";
                });

                overlay.textContent = fullText.trim();
                overlay.style.display = "flex";

                setTimeout(() => {
                    overlay.style.display = "none";
                }, 2000);
            }
        });
    </script> {% endcomment %}

    <div id="message-overlay" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
        flex-direction: column;
    "></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const messages = [
                {% if messages %}
                    {% for message in messages %}
                        {
                            text: `{{ message|escapejs }}`,
                            tags: `{{ message.tags }}`
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                {% else %}
                    // Нет сообщений
                {% endif %}
            ];

            if (messages.length > 0) {
                const overlay = document.getElementById('message-overlay');

                // Формируем HTML для каждого сообщения с нужными классами
                let fullHTML = "";
                messages.forEach(msg => {
                    // Определяем класс для цвета
                    let alertClass = "";
                    if (msg.tags.includes('error')) {
                        alertClass = 'alert-danger';
                    } else if (msg.tags) {
                        alertClass = 'alert-' + msg.tags; // например alert-success, alert-warning и т.п.
                    } else {
                        alertClass = 'alert-info';
                    }

                    // Вставляем разметку с классами Bootstrap
                    fullHTML += `<div class="alert ${alertClass} mt-3" style="margin: 5px 0;">${msg.text}</div>`;
                });

                overlay.innerHTML = fullHTML;
                overlay.style.display = "flex";

                setTimeout(() => {
                    overlay.style.display = "none";
                }, 2000);
            }
        });
    </script>

</body>
</html>
